

<!DOCTYPE html>
<html lang="zh-cn" color-mode=light>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Canvas 碰撞检测 — 外接图形判别/光线投射/分离轴定理 - iaosee</title>
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="google" content="notranslate" />
  <meta name="keywords" content="iaosee, iaosee's blog, Web, Front-end, JavaScript, TypeScript, Graphics, 2D/3D, Canvas, WebGL">
  <meta name="description" content="碰撞检测在许多的动画与绝大多数游戏中，都会应用各种形式...">
  <meta name="author" content="iaosee">
  <link rel="icon" href="/images/icons/favicon-16x16.ico" type="image/png" sizes="16x16">
  <link rel="icon" href="/images/icons/favicon-32x32.ico" type="image/png" sizes="32x32">
  
  
  

  
<link rel="stylesheet" href="/css/style.css">


  
    
<link rel="stylesheet" href="https://at.alicdn.com/t/font_1445822_p6ry5n7lrr.css">

  

  
    
<link rel="stylesheet" href="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/fancybox/3.5.7/jquery.fancybox.min.css">

  

  
    
      
        
        
<link rel="stylesheet" href="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/highlight.js/11.4.0/styles/github.min.css" name="highlight-style" mode="light">

      
        
        
<link rel="stylesheet" href="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/highlight.js/11.4.0/styles/github-dark.min.css" name="highlight-style" mode="dark">

      
  

  <script>
    var CONFIG = window.CONFIG || {};
    var ZHAOO = window.ZHAOO || {};
    CONFIG = {
      isHome: false,
      fancybox: true,
      pjax: false,
      loading: {
        gif: '/images/theme/loading.gif',
        lottie: ''
      },
      lazyload: {
        enable: true,
        only_post: 'false',
        loading: {
          gif: '/images/theme/loading.gif',
          lottie: ''
        }
      },
      donate: {
        enable: false,
        alipay: 'https://pic.izhaoo.com/alipay.jpg',
        wechat: 'https://pic.izhaoo.com/wechat.jpg'
      },
      galleries: {
        enable: true
      },
      fab: {
        enable: true,
        always_show: false
      },
      carrier: {
        enable: true
      },
      daovoice: {
        enable: false
      },
      preview: {
        background: {
          default: '',
          api: 'https://api.unsplash.com/photos/random?client_id=WTOQU8thNHmm9MzBYV6L5ERpE_l4yg76nYuMZYiYD5s&orientation=landscape&query=nature,scenery,arts',
          return_type: 'json',
          data_contents: '["urls","regular"]'
        },
        motto: {
          default: '菡萏香销翠叶残，西风愁起绿波间。',
          typing: true,
          api: 'https://v2.jinrishici.com/one.json',
          data_contents: '["data","content"]'
        },
      },
      qrcode: {
        enable: false,
        type: 'url',
        image: 'https://pic.izhaoo.com/weapp-code.jpg',
      },
      toc: {
        enable: true
      },
      scrollbar: {
        type: ''
      },
      notification: {
        enable: false,
        delay: 4500,
        list: '',
        page_white_list: '',
        page_black_list: ''
      },
      search: {
        enable: false,
        path: ''
      }
    }
  </script>

  

  

<meta name="generator" content="Hexo 7.3.0"></head>

<body class="lock-screen">
  <div class="loading" id="loading"></div>
  
    


  <nav class="navbar">
    <div class="left">
      
        <i class="iconfont iconhome j-navbar-back-home"></i>
      
      
      
        <i class="iconfont iconmoono" id="color-toggle" color-toggle="light"></i>
      
      
    </div>
    <div class="center">Canvas 碰撞检测 — 外接图形判别/光线投射/分离轴定理</div>
    <div class="right">
      <i class="iconfont iconmenu j-navbar-menu"></i>
    </div>
    
  </nav>

  
  

<nav class="menu">
  <div class="menu-container">
    <div class="menu-close">
      <i class="iconfont iconbaseline-close-px"></i>
    </div>
    <ul class="menu-content"><li class="menu-item">
        <a href="/ " class="underline "> 首页</a>
      </li><li class="menu-item">
        <a href="/galleries/ " class="underline "> 相册</a>
      </li><li class="menu-item">
        <a href="/archives/ " class="underline "> 归档</a>
      </li><li class="menu-item">
        <a href="/tags/ " class="underline "> 标签</a>
      </li><li class="menu-item">
        <a href="/categories/ " class="underline "> 分类</a>
      </li></ul>
    
      <div class="menu-copyright"><p>Powered by <a target="_blank" href="https://hexo.io">Hexo</a>  |  Theme - <a target="_blank" href="https://github.com/izhaoo/hexo-theme-zhaoo">zhaoo</a></p></div>
    
  </div>
</nav>
  <main id="main">
  <div class="article-wrap">
    <div class="row container">
      <div class="col-xl-1"></div>
      <div class="col-xl-8"><article class="article">
  <div class="wrap">
    <section class="head">
  <img   class="lazyload" data-original="/images/article/detect-collisions.jpg" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg=="  draggable="false">
  <div class="head-mask">
    <h1 class="head-title">Canvas 碰撞检测 — 外接图形判别/光线投射/分离轴定理</h1>
    <div class="head-info">
      <span class="post-info-item"><i class="iconfont iconcalendar"></i>一月 06, 2021</span>
      
        <span class="post-info-item">
          <i class="iconfont iconeye"></i><span id="/2021/01/06/canvas-core-07-collision-detection/" class="leancloud-counter" data-flag-title="Canvas 碰撞检测 — 外接图形判别/光线投射/分离轴定理"></span>
        </span>
        <span class="post-info-item">
          <i class="iconfont iconheart"></i><span id="/2021/01/06/canvas-core-07-collision-detection/" class="leancloud-like" data-flag-title="Canvas 碰撞检测 — 外接图形判别/光线投射/分离轴定理"></span>
        </span>
      
      <span class="post-info-item"><i class="iconfont iconfont-size"></i>9623</span>
    </div>
  </div>
</section>
    <section class="main">
      <section class="content">
        
        <h2 id="碰撞检测"><a href="#碰撞检测" class="headerlink" title="碰撞检测"></a>碰撞检测</h2><p>在许多的动画与绝大多数游戏中，都会应用各种形式的碰撞检测，本文主要记录碰撞检测的原理以及应用实现。如何检测两个图形之间是否发生了碰撞，有的检测比较简单，比如矩形与矩形之间的碰撞，圆形与圆形之间的碰撞，有的一些检测方式稍微复杂，例如多边形之间的碰撞，不同图形之间的碰撞，不规则图形之间的碰撞，图形在三维空间中的碰撞。比较常见的碰撞检测方法有 —— <strong>外接图形判别法</strong> &#x2F; <strong>光线投射法</strong> &#x2F; <strong>分离轴定理</strong>。</p>
<h2 id="外接图形判别法"><a href="#外接图形判别法" class="headerlink" title="外接图形判别法"></a>外接图形判别法</h2><p>一般在二维平面中碰撞检测，通常是根据物体平面是否发生重合来判定。对于不规则的物体，其实都可以抽象为一个矩形或者圆形， 然后根据物体的外接矩形或者外接圆形来判定，外接图形判定方式比较简单。外接图形会被当作物体的轮廓来参与碰撞检测，此时也被称作为 “边界框” （Bounding box）, 通过检测两个轮廓是否有相交来判定。</p>
<p><strong>外接矩形判别</strong></p>
<p>判断两个矩形是否碰撞，只需要检查一个矩形各个边是否在另一个矩形内部。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs ts"><span class="hljs-keyword">const</span> <span class="hljs-title function_">isCollided</span> = (<span class="hljs-params">sprite, detectSprite</span>) =&gt; &#123;<br>  <span class="hljs-keyword">const</span> spriteRight = sprite.<span class="hljs-property">left</span> + sprite.<span class="hljs-property">width</span>;<br>  <span class="hljs-keyword">const</span> detectSpriteRight = detectSprite.<span class="hljs-property">left</span> + detectSprite.<span class="hljs-property">width</span>;<br>  <span class="hljs-keyword">const</span> spriteBottom = sprite.<span class="hljs-property">top</span> + sprite.<span class="hljs-property">height</span>;<br>  <span class="hljs-keyword">const</span> detectSpriteBottom = detectSprite.<span class="hljs-property">top</span> + detectSprite.<span class="hljs-property">height</span>;<br>  <span class="hljs-keyword">return</span> (<br>    spriteRight &gt; detectSprite.<span class="hljs-property">left</span> &amp;&amp;<br>    sprite.<span class="hljs-property">left</span> &lt; detectSpriteRight &amp;&amp;<br>    spriteBottom &lt; detectSprite.<span class="hljs-property">top</span> &amp;&amp;<br>    detectSpriteBottom &gt; detectSprite.<span class="hljs-property">top</span> &amp;&amp;<br>  )<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>外接圆形判别</strong></p>
<p>判断两个圆形是否碰撞，只需利用勾股定理要检查两个圆形圆心之间的距离是否小于两个圆形的半径之和。</p>
<p style="text-align:center"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="32.269ex" height="4.843ex" style="vertical-align: -1.838ex;" viewBox="0 -1293.7 13893.6 2085" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">\begin{align}
|AB| = \sqrt{(x_1 - x_2) + (y_1 - y_2)}
\end{align}</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-MJMAIN-7C" d="M139 -249H137Q125 -249 119 -235V251L120 737Q130 750 139 750Q152 750 159 735V-235Q151 -249 141 -249H139Z"></path>
<path stroke-width="1" id="E1-MJMATHI-41" d="M208 74Q208 50 254 46Q272 46 272 35Q272 34 270 22Q267 8 264 4T251 0Q249 0 239 0T205 1T141 2Q70 2 50 0H42Q35 7 35 11Q37 38 48 46H62Q132 49 164 96Q170 102 345 401T523 704Q530 716 547 716H555H572Q578 707 578 706L606 383Q634 60 636 57Q641 46 701 46Q726 46 726 36Q726 34 723 22Q720 7 718 4T704 0Q701 0 690 0T651 1T578 2Q484 2 455 0H443Q437 6 437 9T439 27Q443 40 445 43L449 46H469Q523 49 533 63L521 213H283L249 155Q208 86 208 74ZM516 260Q516 271 504 416T490 562L463 519Q447 492 400 412L310 260L413 259Q516 259 516 260Z"></path>
<path stroke-width="1" id="E1-MJMATHI-42" d="M231 637Q204 637 199 638T194 649Q194 676 205 682Q206 683 335 683Q594 683 608 681Q671 671 713 636T756 544Q756 480 698 429T565 360L555 357Q619 348 660 311T702 219Q702 146 630 78T453 1Q446 0 242 0Q42 0 39 2Q35 5 35 10Q35 17 37 24Q42 43 47 45Q51 46 62 46H68Q95 46 128 49Q142 52 147 61Q150 65 219 339T288 628Q288 635 231 637ZM649 544Q649 574 634 600T585 634Q578 636 493 637Q473 637 451 637T416 636H403Q388 635 384 626Q382 622 352 506Q352 503 351 500L320 374H401Q482 374 494 376Q554 386 601 434T649 544ZM595 229Q595 273 572 302T512 336Q506 337 429 337Q311 337 310 336Q310 334 293 263T258 122L240 52Q240 48 252 48T333 46Q422 46 429 47Q491 54 543 105T595 229Z"></path>
<path stroke-width="1" id="E1-MJMAIN-3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path>
<path stroke-width="1" id="E1-MJMAIN-28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path>
<path stroke-width="1" id="E1-MJMATHI-78" d="M52 289Q59 331 106 386T222 442Q257 442 286 424T329 379Q371 442 430 442Q467 442 494 420T522 361Q522 332 508 314T481 292T458 288Q439 288 427 299T415 328Q415 374 465 391Q454 404 425 404Q412 404 406 402Q368 386 350 336Q290 115 290 78Q290 50 306 38T341 26Q378 26 414 59T463 140Q466 150 469 151T485 153H489Q504 153 504 145Q504 144 502 134Q486 77 440 33T333 -11Q263 -11 227 52Q186 -10 133 -10H127Q78 -10 57 16T35 71Q35 103 54 123T99 143Q142 143 142 101Q142 81 130 66T107 46T94 41L91 40Q91 39 97 36T113 29T132 26Q168 26 194 71Q203 87 217 139T245 247T261 313Q266 340 266 352Q266 380 251 392T217 404Q177 404 142 372T93 290Q91 281 88 280T72 278H58Q52 284 52 289Z"></path>
<path stroke-width="1" id="E1-MJMAIN-31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path>
<path stroke-width="1" id="E1-MJMAIN-2212" d="M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z"></path>
<path stroke-width="1" id="E1-MJMAIN-32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path>
<path stroke-width="1" id="E1-MJMAIN-29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path>
<path stroke-width="1" id="E1-MJMAIN-2B" d="M56 237T56 250T70 270H369V420L370 570Q380 583 389 583Q402 583 409 568V270H707Q722 262 722 250T707 230H409V-68Q401 -82 391 -82H389H387Q375 -82 369 -68V230H70Q56 237 56 250Z"></path>
<path stroke-width="1" id="E1-MJMATHI-79" d="M21 287Q21 301 36 335T84 406T158 442Q199 442 224 419T250 355Q248 336 247 334Q247 331 231 288T198 191T182 105Q182 62 196 45T238 27Q261 27 281 38T312 61T339 94Q339 95 344 114T358 173T377 247Q415 397 419 404Q432 431 462 431Q475 431 483 424T494 412T496 403Q496 390 447 193T391 -23Q363 -106 294 -155T156 -205Q111 -205 77 -183T43 -117Q43 -95 50 -80T69 -58T89 -48T106 -45Q150 -45 150 -87Q150 -107 138 -122T115 -142T102 -147L99 -148Q101 -153 118 -160T152 -167H160Q177 -167 186 -165Q219 -156 247 -127T290 -65T313 -9T321 21L315 17Q309 13 296 6T270 -6Q250 -11 231 -11Q185 -11 150 11T104 82Q103 89 103 113Q103 170 138 262T173 379Q173 380 173 381Q173 390 173 393T169 400T158 404H154Q131 404 112 385T82 344T65 302T57 280Q55 278 41 278H27Q21 284 21 287Z"></path>
<path stroke-width="1" id="E1-MJSZ2-221A" d="M1001 1150Q1017 1150 1020 1132Q1020 1127 741 244L460 -643Q453 -650 436 -650H424Q423 -647 423 -645T421 -640T419 -631T415 -617T408 -594T399 -560T385 -512T367 -448T343 -364T312 -259L203 119L138 41L111 67L212 188L264 248L472 -474L983 1140Q988 1150 1001 1150Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
<g transform="translate(167,0)">
<g transform="translate(-11,0)">
<g transform="translate(0,-7)">
 <use xlink:href="#E1-MJMAIN-7C" x="0" y="0"></use>
 <use xlink:href="#E1-MJMATHI-41" x="278" y="0"></use>
 <use xlink:href="#E1-MJMATHI-42" x="1029" y="0"></use>
 <use xlink:href="#E1-MJMAIN-7C" x="1788" y="0"></use>
 <use xlink:href="#E1-MJMAIN-3D" x="2344" y="0"></use>
<g transform="translate(3401,0)">
 <use xlink:href="#E1-MJSZ2-221A" x="0" y="-24"></use>
<rect stroke="none" width="9168" height="60" x="1000" y="1067"></rect>
<g transform="translate(1000,0)">
 <use xlink:href="#E1-MJMAIN-28" x="0" y="0"></use>
<g transform="translate(389,0)">
 <use xlink:href="#E1-MJMATHI-78" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-MJMAIN-31" x="809" y="-213"></use>
</g>
 <use xlink:href="#E1-MJMAIN-2212" x="1638" y="0"></use>
<g transform="translate(2638,0)">
 <use xlink:href="#E1-MJMATHI-78" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-MJMAIN-32" x="809" y="-213"></use>
</g>
 <use xlink:href="#E1-MJMAIN-29" x="3665" y="0"></use>
 <use xlink:href="#E1-MJMAIN-2B" x="4276" y="0"></use>
 <use xlink:href="#E1-MJMAIN-28" x="5277" y="0"></use>
<g transform="translate(5667,0)">
 <use xlink:href="#E1-MJMATHI-79" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-MJMAIN-31" x="693" y="-213"></use>
</g>
 <use xlink:href="#E1-MJMAIN-2212" x="6833" y="0"></use>
<g transform="translate(7834,0)">
 <use xlink:href="#E1-MJMATHI-79" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-MJMAIN-32" x="693" y="-213"></use>
</g>
 <use xlink:href="#E1-MJMAIN-29" x="8778" y="0"></use>
</g>
</g>
</g>
</g>
</g>
</g>
</svg></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs ts"><span class="hljs-keyword">const</span> <span class="hljs-title function_">isCollided</span> = (<span class="hljs-params">sprite, detectSprite</span>) =&gt; &#123;<br>  <span class="hljs-keyword">const</span> distance = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">sqrt</span>(<br>    <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">pow</span>(detectSprite.<span class="hljs-property">x</span> - sprite.<span class="hljs-property">x</span>, <span class="hljs-number">2</span>),<br>    <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">pow</span>(detectSprite.<span class="hljs-property">y</span> - sprite.<span class="hljs-property">y</span>, <span class="hljs-number">2</span>),<br>  );<br>  <span class="hljs-keyword">return</span> distance &lt; sprite.<span class="hljs-property">radius</span> + detectSprite.<span class="hljs-property">radius</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>矩形与圆形的碰撞检测</strong></p>
<p>对于矩形与圆形的碰撞，就是判断矩形的边上最近一点与圆心的距离是否小于半径。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs ts"><span class="hljs-keyword">const</span> <span class="hljs-title function_">isCollided</span> = (<span class="hljs-params">rect, circle</span>) =&gt; &#123;<br>  <span class="hljs-keyword">const</span> bounding = &#123; <span class="hljs-attr">x</span>: rect.<span class="hljs-property">left</span>, <span class="hljs-attr">y</span>: rect.<span class="hljs-property">top</span> &#125;;<br>  <span class="hljs-keyword">if</span> (circle.<span class="hljs-property">x</span> &lt; rect.<span class="hljs-property">left</span>) &#123;<br>    bounding.<span class="hljs-property">x</span> = rect.<span class="hljs-property">left</span>;<br>  &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (circle.<span class="hljs-property">x</span> &lt; rect.<span class="hljs-property">left</span> + rect.<span class="hljs-property">width</span>) &#123;<br>    bounding.<span class="hljs-property">x</span> = circle.<span class="hljs-property">x</span>;<br>  &#125; <span class="hljs-keyword">else</span> &#123;<br>    bounding.<span class="hljs-property">x</span> = rect.<span class="hljs-property">left</span> + rect.<span class="hljs-property">width</span>;<br>  &#125;<br>  <span class="hljs-keyword">if</span> (circle.<span class="hljs-property">y</span> &lt; rect.<span class="hljs-property">top</span>) &#123;<br>    bounding.<span class="hljs-property">y</span> = rect.<span class="hljs-property">top</span>;<br>  &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (circle.<span class="hljs-property">y</span> &lt; rect.<span class="hljs-property">top</span> + rect.<span class="hljs-property">height</span>) &#123;<br>    bounding.<span class="hljs-property">y</span> = circle.<span class="hljs-property">y</span>;<br>  &#125; <span class="hljs-keyword">else</span> &#123;<br>    bounding.<span class="hljs-property">y</span> = rect.<span class="hljs-property">top</span> + rect.<span class="hljs-property">height</span>;<br>  &#125;<br>  <span class="hljs-keyword">const</span> distance = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">sqrt</span>(<br>    <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">pow</span>(bounding.<span class="hljs-property">x</span> - circle.<span class="hljs-property">x</span>, <span class="hljs-number">2</span>),<br>    <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">pow</span>(bounding.<span class="hljs-property">y</span> - circle.<span class="hljs-property">y</span>, <span class="hljs-number">2</span>),<br>  );<br>  <span class="hljs-keyword">return</span> distance &lt; circle.<span class="hljs-property">radius</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<h2 id="光线投射法"><a href="#光线投射法" class="headerlink" title="光线投射法"></a>光线投射法</h2><p>光线投射法 (Ray Casting)：画一条与物体的速度向量相重合的线，然后再从另外一个待检测物体出发，绘制第二条线，根据两条线的交点位置来判定是否发生碰撞。</p>
<p>如果满足如下两个条件，表明发生碰撞：</p>
<ol>
<li>第一条线与第二条线的交点在某个范围内（规定的边界）</li>
<li>物体在位于第二条线的下方位置</li>
</ol>
<p>利用直线的斜截式方程，其中 k 是直线的斜率，b 是直线在 y 轴上的截距，也是直线与 y 轴的交点作纵坐标。</p>
<p style="text-align:center"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="11.384ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 4901.5 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">\begin{align}
y = kx + b
\end{align}</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-MJMATHI-79" d="M21 287Q21 301 36 335T84 406T158 442Q199 442 224 419T250 355Q248 336 247 334Q247 331 231 288T198 191T182 105Q182 62 196 45T238 27Q261 27 281 38T312 61T339 94Q339 95 344 114T358 173T377 247Q415 397 419 404Q432 431 462 431Q475 431 483 424T494 412T496 403Q496 390 447 193T391 -23Q363 -106 294 -155T156 -205Q111 -205 77 -183T43 -117Q43 -95 50 -80T69 -58T89 -48T106 -45Q150 -45 150 -87Q150 -107 138 -122T115 -142T102 -147L99 -148Q101 -153 118 -160T152 -167H160Q177 -167 186 -165Q219 -156 247 -127T290 -65T313 -9T321 21L315 17Q309 13 296 6T270 -6Q250 -11 231 -11Q185 -11 150 11T104 82Q103 89 103 113Q103 170 138 262T173 379Q173 380 173 381Q173 390 173 393T169 400T158 404H154Q131 404 112 385T82 344T65 302T57 280Q55 278 41 278H27Q21 284 21 287Z"></path>
<path stroke-width="1" id="E1-MJMAIN-3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path>
<path stroke-width="1" id="E1-MJMATHI-6B" d="M121 647Q121 657 125 670T137 683Q138 683 209 688T282 694Q294 694 294 686Q294 679 244 477Q194 279 194 272Q213 282 223 291Q247 309 292 354T362 415Q402 442 438 442Q468 442 485 423T503 369Q503 344 496 327T477 302T456 291T438 288Q418 288 406 299T394 328Q394 353 410 369T442 390L458 393Q446 405 434 405H430Q398 402 367 380T294 316T228 255Q230 254 243 252T267 246T293 238T320 224T342 206T359 180T365 147Q365 130 360 106T354 66Q354 26 381 26Q429 26 459 145Q461 153 479 153H483Q499 153 499 144Q499 139 496 130Q455 -11 378 -11Q333 -11 305 15T277 90Q277 108 280 121T283 145Q283 167 269 183T234 206T200 217T182 220H180Q168 178 159 139T145 81T136 44T129 20T122 7T111 -2Q98 -11 83 -11Q66 -11 57 -1T48 16Q48 26 85 176T158 471L195 616Q196 629 188 632T149 637H144Q134 637 131 637T124 640T121 647Z"></path>
<path stroke-width="1" id="E1-MJMATHI-78" d="M52 289Q59 331 106 386T222 442Q257 442 286 424T329 379Q371 442 430 442Q467 442 494 420T522 361Q522 332 508 314T481 292T458 288Q439 288 427 299T415 328Q415 374 465 391Q454 404 425 404Q412 404 406 402Q368 386 350 336Q290 115 290 78Q290 50 306 38T341 26Q378 26 414 59T463 140Q466 150 469 151T485 153H489Q504 153 504 145Q504 144 502 134Q486 77 440 33T333 -11Q263 -11 227 52Q186 -10 133 -10H127Q78 -10 57 16T35 71Q35 103 54 123T99 143Q142 143 142 101Q142 81 130 66T107 46T94 41L91 40Q91 39 97 36T113 29T132 26Q168 26 194 71Q203 87 217 139T245 247T261 313Q266 340 266 352Q266 380 251 392T217 404Q177 404 142 372T93 290Q91 281 88 280T72 278H58Q52 284 52 289Z"></path>
<path stroke-width="1" id="E1-MJMAIN-2B" d="M56 237T56 250T70 270H369V420L370 570Q380 583 389 583Q402 583 409 568V270H707Q722 262 722 250T707 230H409V-68Q401 -82 391 -82H389H387Q375 -82 369 -68V230H70Q56 237 56 250Z"></path>
<path stroke-width="1" id="E1-MJMATHI-62" d="M73 647Q73 657 77 670T89 683Q90 683 161 688T234 694Q246 694 246 685T212 542Q204 508 195 472T180 418L176 399Q176 396 182 402Q231 442 283 442Q345 442 383 396T422 280Q422 169 343 79T173 -11Q123 -11 82 27T40 150V159Q40 180 48 217T97 414Q147 611 147 623T109 637Q104 637 101 637H96Q86 637 83 637T76 640T73 647ZM336 325V331Q336 405 275 405Q258 405 240 397T207 376T181 352T163 330L157 322L136 236Q114 150 114 114Q114 66 138 42Q154 26 178 26Q211 26 245 58Q270 81 285 114T318 219Q336 291 336 325Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
<g transform="translate(167,0)">
<g transform="translate(-11,0)">
<g transform="translate(0,-47)">
 <use xlink:href="#E1-MJMATHI-79" x="0" y="0"></use>
 <use xlink:href="#E1-MJMAIN-3D" x="775" y="0"></use>
 <use xlink:href="#E1-MJMATHI-6B" x="1831" y="0"></use>
 <use xlink:href="#E1-MJMATHI-78" x="2353" y="0"></use>
 <use xlink:href="#E1-MJMAIN-2B" x="3147" y="0"></use>
 <use xlink:href="#E1-MJMATHI-62" x="4148" y="0"></use>
</g>
</g>
</g>
</g>
</svg></p>
<p>找到这两条线的交点，也就是寻找一个同时满足这两个直线方程式的点，所以可以设 第一条线 等于 第二条线的 方程式(此时两个直线方程中的 x 是相同的)，然后解出 x 。<br>当两条直线存在交点 <code>(x, y)</code> 时，则可以得到如下等式，</p>
<p style="text-align:center"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="33.457ex" height="12.176ex" style="vertical-align: -5.505ex;" viewBox="0 -2872.4 14404.9 5242.4" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">\begin{align}
k_1x + b_1 &amp;= k_2x + b_2 \\
k_1x - k_2x &amp;= b_2 - b_1 \\
x(k_1 - k_2) &amp;= b_2 - b_1 \\
x &amp;= (b_2 - b_1) / (k_1 - k_2) \\
\end{align}</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-MJMATHI-6B" d="M121 647Q121 657 125 670T137 683Q138 683 209 688T282 694Q294 694 294 686Q294 679 244 477Q194 279 194 272Q213 282 223 291Q247 309 292 354T362 415Q402 442 438 442Q468 442 485 423T503 369Q503 344 496 327T477 302T456 291T438 288Q418 288 406 299T394 328Q394 353 410 369T442 390L458 393Q446 405 434 405H430Q398 402 367 380T294 316T228 255Q230 254 243 252T267 246T293 238T320 224T342 206T359 180T365 147Q365 130 360 106T354 66Q354 26 381 26Q429 26 459 145Q461 153 479 153H483Q499 153 499 144Q499 139 496 130Q455 -11 378 -11Q333 -11 305 15T277 90Q277 108 280 121T283 145Q283 167 269 183T234 206T200 217T182 220H180Q168 178 159 139T145 81T136 44T129 20T122 7T111 -2Q98 -11 83 -11Q66 -11 57 -1T48 16Q48 26 85 176T158 471L195 616Q196 629 188 632T149 637H144Q134 637 131 637T124 640T121 647Z"></path>
<path stroke-width="1" id="E1-MJMAIN-31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path>
<path stroke-width="1" id="E1-MJMATHI-78" d="M52 289Q59 331 106 386T222 442Q257 442 286 424T329 379Q371 442 430 442Q467 442 494 420T522 361Q522 332 508 314T481 292T458 288Q439 288 427 299T415 328Q415 374 465 391Q454 404 425 404Q412 404 406 402Q368 386 350 336Q290 115 290 78Q290 50 306 38T341 26Q378 26 414 59T463 140Q466 150 469 151T485 153H489Q504 153 504 145Q504 144 502 134Q486 77 440 33T333 -11Q263 -11 227 52Q186 -10 133 -10H127Q78 -10 57 16T35 71Q35 103 54 123T99 143Q142 143 142 101Q142 81 130 66T107 46T94 41L91 40Q91 39 97 36T113 29T132 26Q168 26 194 71Q203 87 217 139T245 247T261 313Q266 340 266 352Q266 380 251 392T217 404Q177 404 142 372T93 290Q91 281 88 280T72 278H58Q52 284 52 289Z"></path>
<path stroke-width="1" id="E1-MJMAIN-2B" d="M56 237T56 250T70 270H369V420L370 570Q380 583 389 583Q402 583 409 568V270H707Q722 262 722 250T707 230H409V-68Q401 -82 391 -82H389H387Q375 -82 369 -68V230H70Q56 237 56 250Z"></path>
<path stroke-width="1" id="E1-MJMATHI-62" d="M73 647Q73 657 77 670T89 683Q90 683 161 688T234 694Q246 694 246 685T212 542Q204 508 195 472T180 418L176 399Q176 396 182 402Q231 442 283 442Q345 442 383 396T422 280Q422 169 343 79T173 -11Q123 -11 82 27T40 150V159Q40 180 48 217T97 414Q147 611 147 623T109 637Q104 637 101 637H96Q86 637 83 637T76 640T73 647ZM336 325V331Q336 405 275 405Q258 405 240 397T207 376T181 352T163 330L157 322L136 236Q114 150 114 114Q114 66 138 42Q154 26 178 26Q211 26 245 58Q270 81 285 114T318 219Q336 291 336 325Z"></path>
<path stroke-width="1" id="E1-MJMAIN-3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path>
<path stroke-width="1" id="E1-MJMAIN-32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path>
<path stroke-width="1" id="E1-MJMAIN-2212" d="M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z"></path>
<path stroke-width="1" id="E1-MJMAIN-28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path>
<path stroke-width="1" id="E1-MJMAIN-29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path>
<path stroke-width="1" id="E1-MJMAIN-2F" d="M423 750Q432 750 438 744T444 730Q444 725 271 248T92 -240Q85 -250 75 -250Q68 -250 62 -245T56 -231Q56 -221 230 257T407 740Q411 750 423 750Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
<g transform="translate(167,0)">
<g transform="translate(-11,0)">
<g transform="translate(871,1951)">
 <use xlink:href="#E1-MJMATHI-6B" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-MJMAIN-31" x="737" y="-213"></use>
 <use xlink:href="#E1-MJMATHI-78" x="975" y="0"></use>
 <use xlink:href="#E1-MJMAIN-2B" x="1770" y="0"></use>
<g transform="translate(2770,0)">
 <use xlink:href="#E1-MJMATHI-62" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-MJMAIN-31" x="607" y="-213"></use>
</g>
</g>
<g transform="translate(206,651)">
 <use xlink:href="#E1-MJMATHI-6B" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-MJMAIN-31" x="737" y="-213"></use>
 <use xlink:href="#E1-MJMATHI-78" x="975" y="0"></use>
 <use xlink:href="#E1-MJMAIN-2212" x="1770" y="0"></use>
<g transform="translate(2770,0)">
 <use xlink:href="#E1-MJMATHI-6B" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-MJMAIN-32" x="737" y="-213"></use>
</g>
 <use xlink:href="#E1-MJMATHI-78" x="3746" y="0"></use>
</g>
<g transform="translate(0,-649)">
 <use xlink:href="#E1-MJMATHI-78" x="0" y="0"></use>
 <use xlink:href="#E1-MJMAIN-28" x="572" y="0"></use>
<g transform="translate(962,0)">
 <use xlink:href="#E1-MJMATHI-6B" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-MJMAIN-31" x="737" y="-213"></use>
</g>
 <use xlink:href="#E1-MJMAIN-2212" x="2159" y="0"></use>
<g transform="translate(3160,0)">
 <use xlink:href="#E1-MJMATHI-6B" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-MJMAIN-32" x="737" y="-213"></use>
</g>
 <use xlink:href="#E1-MJMAIN-29" x="4135" y="0"></use>
</g>
 <use xlink:href="#E1-MJMATHI-78" x="3952" y="-2000"></use>
</g>
<g transform="translate(4514,0)">
<g transform="translate(0,1951)">
 <use xlink:href="#E1-MJMAIN-3D" x="277" y="0"></use>
<g transform="translate(1334,0)">
 <use xlink:href="#E1-MJMATHI-6B" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-MJMAIN-32" x="737" y="-213"></use>
</g>
 <use xlink:href="#E1-MJMATHI-78" x="2309" y="0"></use>
 <use xlink:href="#E1-MJMAIN-2B" x="3104" y="0"></use>
<g transform="translate(4104,0)">
 <use xlink:href="#E1-MJMATHI-62" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-MJMAIN-32" x="607" y="-213"></use>
</g>
</g>
<g transform="translate(0,651)">
 <use xlink:href="#E1-MJMAIN-3D" x="277" y="0"></use>
<g transform="translate(1334,0)">
 <use xlink:href="#E1-MJMATHI-62" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-MJMAIN-32" x="607" y="-213"></use>
</g>
 <use xlink:href="#E1-MJMAIN-2212" x="2439" y="0"></use>
<g transform="translate(3440,0)">
 <use xlink:href="#E1-MJMATHI-62" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-MJMAIN-31" x="607" y="-213"></use>
</g>
</g>
<g transform="translate(0,-649)">
 <use xlink:href="#E1-MJMAIN-3D" x="277" y="0"></use>
<g transform="translate(1334,0)">
 <use xlink:href="#E1-MJMATHI-62" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-MJMAIN-32" x="607" y="-213"></use>
</g>
 <use xlink:href="#E1-MJMAIN-2212" x="2439" y="0"></use>
<g transform="translate(3440,0)">
 <use xlink:href="#E1-MJMATHI-62" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-MJMAIN-31" x="607" y="-213"></use>
</g>
</g>
<g transform="translate(0,-2000)">
 <use xlink:href="#E1-MJMAIN-3D" x="277" y="0"></use>
 <use xlink:href="#E1-MJMAIN-28" x="1334" y="0"></use>
<g transform="translate(1723,0)">
 <use xlink:href="#E1-MJMATHI-62" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-MJMAIN-32" x="607" y="-213"></use>
</g>
 <use xlink:href="#E1-MJMAIN-2212" x="2829" y="0"></use>
<g transform="translate(3829,0)">
 <use xlink:href="#E1-MJMATHI-62" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-MJMAIN-31" x="607" y="-213"></use>
</g>
 <use xlink:href="#E1-MJMAIN-29" x="4713" y="0"></use>
 <use xlink:href="#E1-MJMAIN-2F" x="5102" y="0"></use>
 <use xlink:href="#E1-MJMAIN-28" x="5603" y="0"></use>
<g transform="translate(5992,0)">
 <use xlink:href="#E1-MJMATHI-6B" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-MJMAIN-31" x="737" y="-213"></use>
</g>
 <use xlink:href="#E1-MJMAIN-2212" x="7190" y="0"></use>
<g transform="translate(8191,0)">
 <use xlink:href="#E1-MJMATHI-6B" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-MJMAIN-32" x="737" y="-213"></use>
</g>
 <use xlink:href="#E1-MJMAIN-29" x="9166" y="0"></use>
</g>
</g>
</g>
</g>
</svg></p>
<p>需要注意的是，该方法完全忽略了物体做水平运动与垂直运动的情况。在物体做水平运动时，代表物体运动向量的那条线，斜率为 0 ，物体做垂直运动时，运动向量的斜率为 <code>∞</code> 无穷大，这两个值都不适合用于该方法所要采用的光线投射法。通常管线投射法都会结合边界值检测来进行严格准确的判断。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs ts"><span class="hljs-keyword">function</span> <span class="hljs-title function_">ballInBucket</span>(<span class="hljs-params">ball, bucket</span>) &#123;<br>  <span class="hljs-comment">// (x1, y1) 小球最后位置</span><br>  <span class="hljs-comment">// (x2, y2) 小球当前位置</span><br>  <span class="hljs-comment">// (x3, y3) 水桶左边位置</span><br>  <span class="hljs-comment">// (x4, y4) 水桶右边位置</span><br>  <span class="hljs-keyword">const</span> x1 = lastBallPosition.<span class="hljs-property">x</span>,<br>    y1 = lastBallPosition.<span class="hljs-property">y</span>,<br>    x2 = ball.<span class="hljs-property">x</span>,<br>    y2 = ball.<span class="hljs-property">y</span>,<br>    x3 = bucket.<span class="hljs-property">x</span> + bucket.<span class="hljs-property">width</span> / <span class="hljs-number">4</span>,<br>    y3 = bucket.<span class="hljs-property">y</span>,<br>    x4 = bucket.<span class="hljs-property">x</span> + bucket.<span class="hljs-property">width</span>,<br>    y4 = y3,<br>    k1 = (ball.<span class="hljs-property">y</span> - lastBallPosition.<span class="hljs-property">y</span>) / (ball.<span class="hljs-property">x</span> - lastBallPosition.<span class="hljs-property">x</span>),<br>    k2 = (y4 - y3) / (x4 - x3), <span class="hljs-comment">// zero, but calculate anyway for illustration</span><br>    b1 = y1 - k1 * x1,<br>    b2 = y3 - k2 * x3;<br><br>  <span class="hljs-keyword">const</span> intersectionPoint = &#123;<br>    <span class="hljs-attr">x</span>: (b2 - b1) / (k1 - k2),<br>    <span class="hljs-attr">y</span>: k1 * <span class="hljs-variable language_">this</span>.<span class="hljs-property">intersectionPoint</span>.<span class="hljs-property">x</span> + b1,<br>  &#125;;<br><br>  <span class="hljs-keyword">return</span> (<br>    intersectionPoint.<span class="hljs-property">x</span> &gt; x3 &amp;&amp;<br>    intersectionPoint.<span class="hljs-property">x</span> &lt; x4 &amp;&amp;<br>    ball.<span class="hljs-property">x</span> + ball.<span class="hljs-property">width</span> &lt; x4 &amp;&amp;<br>    ball.<span class="hljs-property">y</span> + ball.<span class="hljs-property">height</span> &gt; y3<br>  );<br>&#125;<br></code></pre></td></tr></table></figure>
<!-- 
function didCollide(ball: CircleSprite, bucket: ImageSprite) {
  let k1 = ball.verticalVelocity / ball.horizontalVelocity;
  let b1 = ball.y - k1 * ball.x;
  let inertSectionY = bucket.top; // 计算交点 Y 坐标
  let insertSectionX = (inertSectionY - b1) / k1; // 计算交点 X 坐标

  return (
    insertSectionX > bucket.left &&
    insertSectionX < bucket.left + bucket.width &&
    ball.x > bucket.left &&
    ball.x < bucket.left + bucket.width &&
    ball.y > bucket.top &&
    ball.y < bucket.top + bucket.height
  );
}
-->


<h3 id="光线投射检测示例"><a href="#光线投射检测示例" class="headerlink" title="光线投射检测示例"></a>光线投射检测示例</h3><iframe 
  class="live-sample-frame sample-code-frame" 
  frameborder="0" 
  height="600" 
  width="100%" 
  loading="lazy"      
  style="width:100%; height:600px; border:0; border-radius: 4px; overflow:hidden;"
  title="canvas-test-demo"
  allow="fullscreen; accelerometer; ambient-light-sensor; camera; encrypted-media; geolocation; gyroscope; hid; microphone; midi; payment; usb; vr; xr-spatial-tracking" 
  src="https://iaosee.com/html5-canvas-core/#/Demo.54">
</iframe>

<p><a href="https://iaosee.com/html5-canvas-core/#/Demo.54">查看完整 Demo 效果</a></p>
<h2 id="分离轴定理"><a href="#分离轴定理" class="headerlink" title="分离轴定理"></a>分离轴定理</h2><p>分离轴定理（SAT —— Separating Axis Theorem），又叫作 “超平面分离定理”。在前面的几种方式并不适用于任意多边形之间的碰撞检测，分离轴定理可用用来检测不同多边形之间碰撞。分离轴定理只适用于凸多边形，也就是内角和小于 180 度的多边形，凸多边形的各个顶点都是由多边形的中心向外延伸的，如矩形，三角形，正方形。</p>
<p>分离轴定理使用数学模型描述：把受测的两个多边形置于一堵墙前面，然后用光线照射它们，然后根据是否相交（是否有间隙）来判断二者有没有相撞。</p>
<p>数学的语言叫做 “投影”，那面墙叫做 “轴”，这样用光线从不同的角度照射到两个图形上，这不同角度的一系列阴影投射到它们之后的墙壁上，如果每一个角度上物体的投影没有间隙，那么这两个物体就一定接触到，如果找到了一个间隙，那么说明这两个物体没有接触。简单来说，就是对于两个凸多边形，若存在一条直线将两者分开，则这两个多边形不相交。</p>
<p>实际应用中，遍历所有角度的分离轴是不现实的，计算量会十分密集，幸运的是，由于多边形的性质，只需要检测其中几个关键的角度。对于两个都是多边形的物体，要检测的角度数量就正好是这个多边形的边数，只需要依次在每条边的垂直线做投影即可。如果两个都是矩形则只需要做四次投影。</p>
<p>需要注意的是：分离轴定理只适用于凸多边形的碰撞检测，凸多边形也就是所有内角均小于 180度的多边形，凸多边形的各个定点都是由多边形的中心，向外延伸的，比如巨型，三角形，正方形。如果只有有一个角大于了 180度，那么这个多变从就有了凹陷，就成了凹多边形，不能使用分离轴定理检测凹多边形之间的碰撞。</p>
<p><img    class="lazyload" data-original="/images/article/Separating-Axis-Projection.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg=="    loading="lazy"><span class="image-caption">投影</span><br><img    class="lazyload" data-original="/images/article/Separating-Axis-Projection-Axis.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg=="    loading="lazy"><span class="image-caption">投影轴</span></p>
<p>分离轴检测步骤：</p>
<ul>
<li>先获取被检测多边形的所有的投影轴，一般只需要计算出多边形对应边的投影轴即可</li>
<li>计算出被检测多边形在每一条投影轴上的投影</li>
<li>判断它们的投影是否有重叠，如果存在在任意一条投影轴的投影不重叠，则说明它们没有发生碰撞，否则就发生了碰撞</li>
</ul>
<p>使用分离轴定理判断连个多边形是否碰撞，伪代码如下：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs ts"><span class="hljs-keyword">const</span> <span class="hljs-title function_">isCollided</span> = (<span class="hljs-params">polygon1, polygon2</span>) =&gt; &#123;<br>  <span class="hljs-keyword">const</span> axes = polygon1.<span class="hljs-title function_">getAxes</span>();<br>  axes.<span class="hljs-title function_">push</span>(...polygon2.<span class="hljs-title function_">getAxes</span>());<br>  <span class="hljs-keyword">for</span>(<span class="hljs-keyword">const</span> axis <span class="hljs-keyword">in</span> axes) &#123;<br>    <span class="hljs-keyword">const</span> projection1 = polygon1.<span class="hljs-title function_">projection</span>(axis);<br>    <span class="hljs-keyword">const</span> projection2 = polygon2.<span class="hljs-title function_">projection</span>(axis);<br>    <span class="hljs-keyword">if</span> (!projection1.<span class="hljs-title function_">overlaps</span>(projection2)) &#123;<br>      <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>    &#125;<br>  &#125;<br>  <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>将伪代码转换为实际应用之前，需要解决几个问题：</p>
<ul>
<li>如何确定多边形的各个投影轴 ？</li>
<li>如何将多边形投射到某条分离轴上 ？</li>
<li>如何检测两段投影是否发生重叠 ？</li>
</ul>
<h3 id="投影轴"><a href="#投影轴" class="headerlink" title="投影轴"></a>投影轴</h3><p>使用分离轴检测多边形的碰撞，必须要能够根据多边形找到它所有的投影轴。如图所示，从 p1 指向 p2 的向量表示多边形的某个边，这个向量叫做<strong>边缘向量</strong>。还需要确定一条垂直于边缘向量的法向量，叫做<strong>边缘法向量</strong>。投影轴位于图形下方，但是其实这条轴的位置无所谓，因为这条轴无论位于哪里，轴的是长度无限的，故而多边形在该轴上的投影也都是一样的，这条轴的方向才是关键。</p>
<p><img    class="lazyload" data-original="/images/article/%E6%8A%95%E5%BD%B1%E8%BD%B4-%E6%B3%95%E5%90%91%E9%87%8F.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg=="    loading="lazy"><span class="image-caption">投影</span></p>
<p>给定 p1 和 p2 两点，可以得到一条垂直于边缘向量的投影轴。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs ts"><span class="hljs-keyword">const</span> v1 = <span class="hljs-title class_">Vector</span>(p1.<span class="hljs-property">x</span>, p1.<span class="hljs-property">y</span>);<br><span class="hljs-keyword">const</span> v2 = <span class="hljs-title class_">Vector</span>(p2.<span class="hljs-property">x</span>, p2.<span class="hljs-property">y</span>);<br><span class="hljs-keyword">const</span> axis = v1.<span class="hljs-title function_">edge</span>(v2).<span class="hljs-title function_">normal</span>();<br></code></pre></td></tr></table></figure>

<p>Vector 的实现：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><code class="hljs ts"><span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Vector</span> &#123;<br>  <span class="hljs-keyword">public</span> <span class="hljs-attr">x</span>: <span class="hljs-built_in">number</span>;<br>  <span class="hljs-keyword">public</span> <span class="hljs-attr">y</span>: <span class="hljs-built_in">number</span>;<br><br>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">constructor</span>(<span class="hljs-params">x?: <span class="hljs-built_in">number</span>, y?: <span class="hljs-built_in">number</span></span>) &#123;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">x</span> = x || <span class="hljs-number">0</span>;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">y</span> = y || <span class="hljs-number">0</span>;<br>  &#125;<br><br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-title function_">fromPoint</span>(<span class="hljs-params"><span class="hljs-attr">p</span>: <span class="hljs-title class_">Point</span></span>) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Vector</span>(p.<span class="hljs-property">x</span>, p.<span class="hljs-property">y</span>);<br>  &#125;<br><br>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">equals</span>(<span class="hljs-params"><span class="hljs-attr">v</span>: <span class="hljs-title class_">Vector</span></span>) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">x</span> === v.<span class="hljs-property">x</span> &amp;&amp; <span class="hljs-variable language_">this</span>.<span class="hljs-property">y</span> === v.<span class="hljs-property">y</span>;<br>  &#125;<br><br>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">getMagnitude</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">sqrt</span>(<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">pow</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">x</span>, <span class="hljs-number">2</span>) + <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">pow</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">y</span>, <span class="hljs-number">2</span>));<br>  &#125;<br><br>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">add</span>(<span class="hljs-params"><span class="hljs-attr">v</span>: <span class="hljs-title class_">Vector</span></span>) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Vector</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">x</span> + v.<span class="hljs-property">x</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">y</span> + v.<span class="hljs-property">y</span>);<br>  &#125;<br><br>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">subtract</span>(<span class="hljs-params"><span class="hljs-attr">v</span>: <span class="hljs-title class_">Vector</span></span>) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Vector</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">x</span> - v.<span class="hljs-property">x</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">y</span> - v.<span class="hljs-property">y</span>);<br>  &#125;<br><br>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">dotProduct</span>(<span class="hljs-params"><span class="hljs-attr">v</span>: <span class="hljs-title class_">Vector</span></span>) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">x</span> * v.<span class="hljs-property">x</span> + <span class="hljs-variable language_">this</span>.<span class="hljs-property">y</span> * v.<span class="hljs-property">y</span>;<br>  &#125;<br><br>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">edge</span>(<span class="hljs-params"><span class="hljs-attr">v</span>: <span class="hljs-title class_">Vector</span></span>) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">subtract</span>(v);<br>  &#125;<br><br>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">perpendicular</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Vector</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">y</span>, <span class="hljs-number">0</span> - <span class="hljs-variable language_">this</span>.<span class="hljs-property">x</span>);<br>  &#125;<br><br>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">normalize</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">const</span> m = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getMagnitude</span>();<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Vector</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">x</span> / m, <span class="hljs-variable language_">this</span>.<span class="hljs-property">y</span> / m);<br>  &#125;<br><br>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">normal</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">const</span> p = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">perpendicular</span>();<br>    <span class="hljs-keyword">return</span> p.<span class="hljs-title function_">normalize</span>();<br>  &#125;<br><br>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">reflect</span>(<span class="hljs-params"><span class="hljs-attr">axis</span>: <span class="hljs-title class_">Vector</span></span>) &#123;<br>    <span class="hljs-keyword">const</span> vdotl = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">dotProduct</span>(axis);<br>    <span class="hljs-keyword">const</span> ldotl = axis.<span class="hljs-title function_">dotProduct</span>(axis);<br>    <span class="hljs-keyword">const</span> dotProductRatio = vdotl / ldotl;<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Vector</span>(<span class="hljs-number">2</span> * dotProductRatio * axis.<span class="hljs-property">x</span> - <span class="hljs-variable language_">this</span>.<span class="hljs-property">x</span>, <span class="hljs-number">2</span> * dotProductRatio * axis.<span class="hljs-property">y</span> - <span class="hljs-variable language_">this</span>.<span class="hljs-property">y</span>);<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><code>perpendicular()</code> 获取与之垂直的向量， <code>normalize()</code> 获取归一化后的向量。现在只需要把需要检测的多边形的每一条边所对应的投影轴确定下来，并检测每条轴上的投影是否有分离。有分离则未碰撞，否则则碰撞。</p>
<p>Projection 类检测是否发生重叠：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs ts"><span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Projection</span> &#123;<br>  <span class="hljs-keyword">public</span> <span class="hljs-attr">min</span>: <span class="hljs-built_in">number</span>;<br>  <span class="hljs-keyword">public</span> <span class="hljs-attr">max</span>: <span class="hljs-built_in">number</span>;<br><br>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">constructor</span>(<span class="hljs-params"><span class="hljs-attr">min</span>: <span class="hljs-built_in">number</span>, <span class="hljs-attr">max</span>: <span class="hljs-built_in">number</span></span>) &#123;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">min</span> = min;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">max</span> = max;<br>  &#125;<br><br>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">overlaps</span>(<span class="hljs-params"><span class="hljs-attr">p</span>: <span class="hljs-title class_">Projection</span></span>) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">max</span> &gt; p.<span class="hljs-property">min</span> &amp;&amp; p.<span class="hljs-property">max</span> &gt; <span class="hljs-variable language_">this</span>.<span class="hljs-property">min</span>;<br>  &#125;<br><br>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">getOverlap</span>(<span class="hljs-params"><span class="hljs-attr">projection</span>: <span class="hljs-title class_">Projection</span></span>) &#123;<br>    <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">overlaps</span>(projection)) &#123;<br>      <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">let</span> overlap;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">max</span> &gt; projection.<span class="hljs-property">max</span>) &#123;<br>      overlap = projection.<span class="hljs-property">max</span> - <span class="hljs-variable language_">this</span>.<span class="hljs-property">min</span>;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>      overlap = <span class="hljs-variable language_">this</span>.<span class="hljs-property">max</span> - projection.<span class="hljs-property">min</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">return</span> overlap;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>Polygon 类的 <code>getAxes()</code> 方法</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs ts"><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Polygon</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">Shape</span> &#123;<br>  <span class="hljs-keyword">public</span> <span class="hljs-attr">points</span>: <span class="hljs-title class_">Point</span>[] = [];<br><br>  <span class="hljs-comment">// ....................</span><br><br>  <span class="hljs-comment">/** <span class="hljs-doctag">@override</span> */</span><br>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">getAxes</span>(): <span class="hljs-title class_">Vector</span>[] &#123;<br>    <span class="hljs-keyword">const</span> axes = [];<br>    <span class="hljs-keyword">const</span> len = <span class="hljs-variable language_">this</span>.<span class="hljs-property">points</span>.<span class="hljs-property">length</span>;<br><br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; len - <span class="hljs-number">1</span>; i++) &#123;<br>      <span class="hljs-keyword">const</span> p1 = <span class="hljs-variable language_">this</span>.<span class="hljs-property">points</span>[i];<br>      <span class="hljs-keyword">const</span> p2 = <span class="hljs-variable language_">this</span>.<span class="hljs-property">points</span>[i + <span class="hljs-number">1</span>];<br>      <span class="hljs-keyword">const</span> v1 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Vector</span>(p1.<span class="hljs-property">x</span>, p1.<span class="hljs-property">y</span>);<br>      <span class="hljs-keyword">const</span> v2 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Vector</span>(p2.<span class="hljs-property">x</span>, p2.<span class="hljs-property">y</span>);<br>      axes.<span class="hljs-title function_">push</span>(v1.<span class="hljs-title function_">edge</span>(v2).<span class="hljs-title function_">normal</span>());<br>    &#125;<br><br>    <span class="hljs-keyword">const</span> v1 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Vector</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">points</span>[len - <span class="hljs-number">1</span>].<span class="hljs-property">x</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">points</span>[len - <span class="hljs-number">1</span>].<span class="hljs-property">y</span>);<br>    <span class="hljs-keyword">const</span> v2 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Vector</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">points</span>[<span class="hljs-number">0</span>].<span class="hljs-property">x</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">points</span>[<span class="hljs-number">0</span>].<span class="hljs-property">y</span>);<br>    axes.<span class="hljs-title function_">push</span>(v1.<span class="hljs-title function_">edge</span>(v2).<span class="hljs-title function_">normal</span>());<br><br>    <span class="hljs-keyword">return</span> axes;<br>  &#125;<br><br>  <span class="hljs-comment">// ....................</span><br>&#125;<br></code></pre></td></tr></table></figure>

<p>Shape 类的检测是否碰撞</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs ts"><span class="hljs-keyword">export</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Shape</span> &#123;<br>  <span class="hljs-comment">// ....................</span><br><br>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">collidesWith</span>(<span class="hljs-params"><span class="hljs-attr">shape</span>: <span class="hljs-title class_">Shape</span></span>) &#123;<br>    <span class="hljs-keyword">const</span> axes = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getAxes</span>().<span class="hljs-title function_">concat</span>(shape.<span class="hljs-title function_">getAxes</span>());<br>    <span class="hljs-keyword">return</span> !<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">separationOnAxes</span>(axes, shape);<br>  &#125;<br><br>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">separationOnAxes</span>(<span class="hljs-params"><span class="hljs-attr">axes</span>: <span class="hljs-title class_">Array</span>&lt;<span class="hljs-title class_">Vector</span>&gt;, <span class="hljs-attr">shape</span>: <span class="hljs-title class_">Shape</span></span>) &#123;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>, len = axes.<span class="hljs-property">length</span>; i &lt; len; i++) &#123;<br>      <span class="hljs-keyword">const</span> axis = axes[i];<br>      <span class="hljs-keyword">const</span> projection1 = shape.<span class="hljs-title function_">project</span>(axis);<br>      <span class="hljs-keyword">const</span> projection2 = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">project</span>(axis);<br>      <span class="hljs-keyword">if</span> (!projection1.<span class="hljs-title function_">overlaps</span>(projection2)) &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>      &#125;<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>  &#125;<br><br>  <span class="hljs-comment">// ....................</span><br><br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-title function_">move</span>(<span class="hljs-attr">dx</span>: <span class="hljs-built_in">number</span>, <span class="hljs-attr">dy</span>: <span class="hljs-built_in">number</span>): <span class="hljs-built_in">void</span>;<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-title function_">createPath</span>(<span class="hljs-attr">context</span>: <span class="hljs-title class_">CanvasRenderingContext2D</span>): <span class="hljs-built_in">void</span>;<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-title function_">getAxes</span>(): <span class="hljs-title class_">Vector</span>[];<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-title function_">project</span>(<span class="hljs-attr">axis</span>: <span class="hljs-title class_">Vector</span>): <span class="hljs-title class_">Projection</span>;<br><br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-title function_">centroid</span>(): <span class="hljs-title class_">Point</span>;<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-title function_">getBoundingBox</span>(): <span class="hljs-title class_">Rectangle</span>;<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-title function_">collidesMTVWith</span>(<span class="hljs-attr">shape</span>: <span class="hljs-title class_">Shape</span>, displacement?: <span class="hljs-built_in">number</span>): <span class="hljs-title class_">MinimumTranslationVector</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="分离轴定理碰撞检测示例"><a href="#分离轴定理碰撞检测示例" class="headerlink" title="分离轴定理碰撞检测示例"></a>分离轴定理碰撞检测示例</h3><iframe 
  class="live-sample-frame sample-code-frame" 
  frameborder="0" 
  height="600" 
  width="100%" 
  loading="lazy"      
  style="width:100%; height:600px; border:0; border-radius: 4px; overflow:hidden;"
  title="canvas-test-demo"
  allow="fullscreen; accelerometer; ambient-light-sensor; camera; encrypted-media; geolocation; gyroscope; hid; microphone; midi; payment; usb; vr; xr-spatial-tracking" 
  src="https://iaosee.com/html5-canvas-core/#/Demo.60">
</iframe>

<p><a href="https://iaosee.com/html5-canvas-core/#/Demo.60">查看完整 Demo 效果</a></p>

      </section>
      <section class="extra">
        
          <ul class="copyright">
  
    <li><strong>本文作者：</strong>iaosee</li>
    <li><strong>本文链接：</strong><a href="http://iaosee.com/2021/01/06/canvas-core-07-collision-detection/index.html" title="http:&#x2F;&#x2F;iaosee.com&#x2F;2021&#x2F;01&#x2F;06&#x2F;canvas-core-07-collision-detection&#x2F;index.html">http:&#x2F;&#x2F;iaosee.com&#x2F;2021&#x2F;01&#x2F;06&#x2F;canvas-core-07-collision-detection&#x2F;index.html</a></li>
    <li><strong>版权声明：</strong>本博客所有文章均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" title="BY-NC-SA" target="_blank" rel="noopener">BY-NC-SA</a> 许可协议，转载请注明出处！</li>
  
</ul>
        
        
        
  <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/2D/" rel="tag">2D</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Canvas/" rel="tag">Canvas</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%9B%BE%E5%BD%A2%E5%BC%80%E5%8F%91/" rel="tag">图形开发</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%A2%B0%E6%92%9E%E6%A3%80%E6%B5%8B/" rel="tag">碰撞检测</a></li></ul> 

        
  <nav class="nav">
    <a></a>
    <a href="/2021/01/02/canvas-core-06-sprite-system/">Canvas 精灵 - 精灵系统实现 🧚<i class="iconfont iconright"></i></a>
  </nav>

      </section>
      
        <section class="comments">
  
  
<div id="giscus" class="giscus"></div>
<script>
window.onload = function() {

  function loadGiscus() {
    var script = document.createElement("script");
    script.src = 'https://giscus.app/client.js';
    script.type = 'text/javascript';
    script.crossorigin = 'anonymous';
    script.async = true;
    script.dataset.loading = 'lazy';
    script.dataset.repo = 'iaosee/iaosee.github.io';
    script.dataset.repoId = 'MDEwOlJlcG9zaXRvcnk4ODczNjY2Ng==';
    script.dataset.mapping = 'pathname';
    script.dataset.category = 'Announcements';
    script.dataset.categoryId = 'DIC_kwDOBUoDms4CQP9t';
    script.dataset.inputPosition = 'top';
    script.dataset.reactionsEnabled = '1';
    script.dataset.emitMetadata = '';
    script.dataset.lang = 'zh-CN';
    script.dataset.theme = localStorage.getItem('color-mode') || 'preferred_color_scheme';
    document.getElementById('giscus').parentElement.appendChild(script);
  }

  function sendGiscusMessage(message) {
    var iframe = document.querySelector('iframe.giscus-frame');
    if (!iframe) return;
    var msgData = { giscus: message };
    // console.log('send message -- ', msgData);
    iframe.contentWindow.postMessage(msgData, 'https://giscus.app');
  }
  // window.sendGiscusMessage = sendGiscusMessage;

  function handleMessage(event) {
    if (event.origin !== 'https://giscus.app') return;
    if (!(typeof event.data === 'object' && event.data.giscus)) return;
    const giscusData = event.data.giscus;
    // console.log('recived giscus message -- ', giscusData)
  }
  window.addEventListener('message', handleMessage);
  window.addEventListener('beforeunload', function() {
    window.removeEventListener('message', handleMessage);
  });

  var toggleElement = document.getElementById('color-toggle');
  if (toggleElement) {
    toggleElement.addEventListener('click', function () {
      const mode = localStorage.getItem('color-mode');
      sendGiscusMessage({
        setConfig: {
          theme: mode,
        }
      });
    });
  }

  if ( false ) {
    $("#comments-btn").on("click", function (e) {
      $(this).hide();
      loadGiscus();
    });
  } else {
    loadGiscus();
  }
}
</script>


</section>
      
    </section>
  </div>
</article></div>
      <div class="col-xl-3">
        
          
  <aside class="toc-wrap">
    <h3 class="toc-title">文章目录：</h3>
    <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%A2%B0%E6%92%9E%E6%A3%80%E6%B5%8B"><span class="toc-text">碰撞检测</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A4%96%E6%8E%A5%E5%9B%BE%E5%BD%A2%E5%88%A4%E5%88%AB%E6%B3%95"><span class="toc-text">外接图形判别法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%89%E7%BA%BF%E6%8A%95%E5%B0%84%E6%B3%95"><span class="toc-text">光线投射法</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%89%E7%BA%BF%E6%8A%95%E5%B0%84%E6%A3%80%E6%B5%8B%E7%A4%BA%E4%BE%8B"><span class="toc-text">光线投射检测示例</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%86%E7%A6%BB%E8%BD%B4%E5%AE%9A%E7%90%86"><span class="toc-text">分离轴定理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8A%95%E5%BD%B1%E8%BD%B4"><span class="toc-text">投影轴</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E7%A6%BB%E8%BD%B4%E5%AE%9A%E7%90%86%E7%A2%B0%E6%92%9E%E6%A3%80%E6%B5%8B%E7%A4%BA%E4%BE%8B"><span class="toc-text">分离轴定理碰撞检测示例</span></a></li></ol></li></ol>
  </aside>

        
      </div>
    </div>
  </div>
</main>

  

<footer class="footer">
  <div class="footer-social"><a 
        href="https://github.com/iaosee "
        target="_blank"
        class="footer-social-item"
        onMouseOver="this.style.color= '#9f7be1'" 
        onMouseOut="this.style.color='#33333D'">
          <i class="iconfont  icongithub-fill "></i>
      </a><a 
        href="mailto:iaosee@outlook.com "
        target="_blank"
        class="footer-social-item"
        onMouseOver="this.style.color=#FF3B00" 
        onMouseOut="this.style.color='#33333D'">
          <i class="iconfont  iconmail"></i>
      </a></div>
  
    <div class="footer-copyright"><p>Powered by <a target="_blank" href="https://hexo.io">Hexo</a>  |  Theme - <a target="_blank" href="https://github.com/izhaoo/hexo-theme-zhaoo">zhaoo</a></p></div>
  
</footer>
  
      <div class="fab fab-plus">
    <i class="iconfont iconplus"></i>
  </div>
  
    <div class="fab fab-like">
      <i class="iconfont iconheart"></i>
    </div>
  
  
  
  <div class="fab fab-up">
    <i class="iconfont iconcaret-up"></i>
  </div>
  
  
  
    
<script src="/js/color-mode.js"></script>

  
  
</body>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>





  
<script src="https://lf6-cdn-tos.bytecdntp.com/cdn/expire-1-M/jquery.lazyload/1.9.1/jquery.lazyload.min.js"></script>




  
<script src="https://lf26-cdn-tos.bytecdntp.com/cdn/expire-1-M/fancybox/3.5.7/jquery.fancybox.min.js"></script>








<script src="/js/utils.js"></script>
<script src="/js/script.js"></script>



  <script>
  $.getScript("//cdn.jsdelivr.net/npm/leancloud-storage@4.15.2/dist/av.min.js", () => {

    AV.init({
      appId: 'QRsYxiOY3VGeVhkqx7yJiz0U-gzGzoHsz',
      appKey: '1ygwFPYG8IbvlgnrnNXrNeNe',
      serverURLs: 'https://leancloud.cn/',
    });

    const Counter = AV.Object.extend("Counter");
    const Like = AV.Object.extend("Like");

    const showCount = (Counter) => {
      const asyncLimit = new AsyncLimit(2);
      $(".leancloud-counter").each(async (e) => {
        const url = $(".leancloud-counter").eq(e).attr('id').trim();
        const query = new AV.Query("Counter");
        query.equalTo("words", url);
        let count = await asyncLimit.run(() => query.count());
        $(".leancloud-counter").eq(e).text(count ? count : 0);
      });
    }

    const addCount = (Counter) => {
      const url = $(".leancloud-counter").length === 1 ? $(".leancloud-counter").attr('id').trim() : 'http://iaosee.com';
      var query = new Counter;
      query.save({
        words: url
      });
    }

    const showLike = (Like) => {
      const asyncLimit = new AsyncLimit(2);
      $(".leancloud-like").each(async (e) => {
        const url = $(".leancloud-like").eq(e).attr('id').trim();
        const query = new AV.Query("Like");
        query.equalTo("path", url);
        let count = await asyncLimit.run(() => query.count());
        $(".leancloud-like").eq(e).text(count ? count : 0);
      });
    }

    const addLike = (Like) => {
      const url = $(".leancloud-like").length === 1 ? $(".leancloud-like").attr('id').trim() : 'http://iaosee.com';
      var query = new Like;
      query.save({
        path: url,
        nickName: 'Anonymous'
      });
      $(".leancloud-like").addClass('islike');
      $(".fab-like").children(".iconfont").removeClass("iconheart").addClass("iconheart-fill").css("color", "#eb3223");
      ZHAOO.zui.message({ text: '爱你哦~', type: 'success' });
      setTimeout(() => showLike(Like), 1000);
    }

    const handleLikeClick = () => {
      const isLike = $(".leancloud-like").length === 1 && $(".leancloud-like").hasClass('islike') ? true : false;
      if (isLike) {
        ZHAOO.zui.message({ text: '小心心不可以收回呢~', type: 'warning' });
      } else {
        addLike(Like);
      }
    }

    $(function () {
      addCount(Counter);
      showCount(Counter);
      showLike(Like);
      $(".fab-like").on("click", function () {
        handleLikeClick();
      });
    });

  });
</script>






  <script>
    (function () {
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
      } else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
    })();
  </script>



  <script defer src='https://hm.baidu.com/hm.js?fa215b20eccf04179a4d316087693164'></script>










</html>